# Об этом приложении

Минималистичный сайт c [моими](https://t.me/isayev_ivan) [«вечно-зелёными»](https://arseny.page/newsletter/letter-23/) заметками о заточке ножей в стиле [Энди Матушака](https://notes.andymatuschak.org/About_these_notes).

Особенности реализации:

* файловое хранилище заметок (`/notes/*.md`) без бэкенда
* кириллические имена файлов и вики-ссылки, но **URL — реализованы на [slug](https://tenchat.ru/media/1833069-chto-takoye-slug-v-razrabotke-primer-koda)’ах**
* «горизонтальная лента» колонок: ссылки-заметки открываются в колонке справа рядом, с собственным скроллом
* по ховеру для внутренних ссылок показываются превью заметок
* у каждой заметки автоматически генерируется блок бэклинков: ссылок на заметки, которые ссылаются на текущую заметку
* полноэкранный поиск по заголовкам/алиасам
* тёмная/светлая тема
* PWA/офлайн: заметки кешируются и авто-обновляются
* Мини-SEO: данные текущей заметки подставляются в title/description/canonical
* Проверка битых/двусмысленных ссылок на сборке (и их подсветка в UI)

Используемый стек: **TypeScript, Vue 3 (Composition API), Vite, Pinia, markdown-it, gray-matter, slugify, vite-plugin-pwa**. Деплой на **GitHub Pages**.

---

# Как пользоваться (для авторов заметок)

## Где лежат заметки

Папка `notes/`. Каждый файл — одна заметка. Имя файла может быть кириллицей:
`notes/Техники заточки ножа.md`

## Опциональный Frontmatter (вверху файла)

```yaml
---
title: Техника заточки            # заголовок (если нет — берется из имени файла)
description: Короткое резюме...   # попадёт в <meta name="description"> (если нет — берется из первого текста)
aliases:                          # синонимы для вики-ссылок и поиска
  - Заточка ножа
  - Knife sharpening
slug: sharpening-technique        # желаемый URL (если нет — сгенерируется сам)
# вместо slug можно url / permalink — эффект тот же
---
```

* **title** → заголовок колонки, подписи, поиск.
* **description** → имеет приоритет для `<meta name="description">` (SEO и шаринг); если не задан — берём первые абзацы текста (без картинок).
* **aliases** → по этим словам можно ссылаться в тексте и искать.
* **slug / url / permalink** → переопределяет адрес заметки. Если не задан, slug генерируется из `title`/имени файла (кириллица транслитерируется).


## Как ссылаться

Вики-ссылки двух видов:

* `[[Заметка]]`
* `[[Заметка | отображаемый текст]]`

Где `Заметка` — **название/алиас/имя файла** (на кириллице).
Приложение нормализует это в slug и открывает нужную заметку.

### Подсветка проблем:

* Ссылка на несуществующую заметку — **красная** (`.is-missing`).
* Двусмысленная ссылка (несколько заметок претендуют на один алиас/title/fileName) — **янтарная с пунктиром** (`.is-ambiguous`) + **мини-тултип** со списком кандидатов.

### Превью по ховеру

Для внутренних ссылок показывается поповер **без изображений**, первые 2–3 абзаца. Кешируется, чтобы не дёргать парсер лишний раз.

---

# Как пользоваться (для читателей)

* **Клик по ссылке** в тексте открывает новую колонку справа; старая остаётся.
* **Колонки скроллятся по горизонтали**. При открытии «ленту» автоматически прокручивает к новой колонке.
* **Активная колонка** подсвечена тонкой рамкой; меняется:

  * стрелками **←/→**,
  * кликом по колонке,
  * автоматически при горизонтальном скролле (если колонка достаточно видна в вьюпорте).
* **Esc** закрывает **активную** колонку (если их больше одной).
* **?** — подсказка по хоткеям.
* **/** — полноэкранный поиск (работает и с кириллицей).
* **Тема**: переключатель в верхней панели (сохраняется).

**Сохранение контекста:** URL, активная колонка, **горизонтальный** и **вертикальные** скроллы колонок сохраняются между сессиями (localStorage). После перезагрузки вернёшься туда же.

---

# Поиск

Полноэкранный оверлей:

* Поиск по **заголовкам** и **алиасам**.
* Подсветка совпадений.
* В выдаче: заголовок, slug, короткий сниппет из текста.
* Открытие — Enter мышкой/клавишами.
* Хоткей `/`, на мобилках — иконка «лупа» в топ-баре.

---

# Топ-бар

Слева — название сайта (настраивается), справа — «Об этих заметках» (ведёт на корневую заметку), переключатель темы и кнопка поиска.

---

# Как устроены URL

* Главная заметка — `index.md`. Когда она открыта одна, **URL пустой** (как обычный сайт).
* Остальные заметки — по **slug**: `/<slug>`.
* Если открыто несколько колонок — URL содержит стэк (для прямых ссылок/восстановления).
* В URL нет `#` — используется **history mode**; для GitHub Pages включен spa-fallback (`404.html` = `index.html`).

---

# Анимации и лоадер (без мигания)

* Появление колонки: **fade-in + лёгкий подъезд вверх**, со «стаггером» слева направо.
* Если контент успевает загрузиться быстрее `loaderDelay` — показываем сразу **без лоадера**.
* Если дольше — показываем лоадер минимум `loaderMin`, затем контент — чтобы не было «мигания».
* Закрытие колонки — плавное «затухание + опускание», соседние колонки **мягко переезжают** на её место (FLIP-анимация через `<TransitionGroup>`).

**Тонкая настройка:**

* `VITE_ANIM_LOADER_DELAY` (мс, по умолчанию **200**)
* `VITE_ANIM_LOADER_MIN` (мс, по умолчанию **500**)
* `VITE_ANIM_STAGGER` (мс/колонка, по умолчанию **80**)

---

# SEO (минимально, но полезно)

При смене активной колонки обновляются:

* `<title>`: `«Заголовок — Название сайта»`
* `<meta name="description">`: **frontmatter.description** → иначе сниппет из первых абзацев
* `<link rel="canonical">`: canonical-URL в slug-виде (для `index.md` — корневой адрес)
* базовые Open Graph теги (`og:title/description/url`)

Можно задать имя сайта: `.env` → `VITE_SITE_NAME="Заметки о ножах"`.

---

# PWA / офлайн

* `vite-plugin-pwa` предкэширует бандл (включая чанки с Markdown).
* Авто-обновление SW: новая версия подтягивается и активируется (выбран «тихий» режим).
* Иконки PWA: `public/pwa-192x192.png`, `public/pwa-512x512.png` (и свои фавиконки).
* В `tsconfig` подключена `lib: ["WebWorker"]`.
* Для типов PWA — `@vite-pwa/assets-generator` (dev-dep).

**Как проверить офлайн:** `npm run build && npm run preview` → DevTools → Offline → переходы по уже открытым заметкам работают.

---

# Проверка ссылок (линк-гигиена)

На сборке (и в dev-логе) автоматически:

* ищем **битые** вики-ссылки (подсветка в UI + отчёт),
* ищем **двусмысленные** алиасы (когда на один ключ претендуют несколько заметок) — учитываем **aliases, title, fileName**.

Результаты:

* в консоли: сводка,
* файл `notes-check.json` (в корне проекта),
* при `CI=true` или `VITE_NOTES_FAIL_ON_BROKEN=true` сборка **падает**, если есть проблемы.

В UI:

* битые — красные (`.is-missing`),
* двусмысленные — янтарные (`.is-ambiguous`) + **тултип-подсказка** с перечислением кандидатов.

---

# Как это работает «под капотом»

## Предсборка (Vite плагин `plugins/notesPlugin.ts`)

* Бежит по `notes/**/*.md`, читает **frontmatter** и текст.
* Строит:

  * **manifest**: `{slug,title,path}`
  * **graph**:

    * `aliasMap` (aliases + title + fileName → canon slug)
    * `outgoing/incoming` (граф ссылок)
    * `excerptsBySlug` (HTML первых абзацев для превью)
    * `descriptionsBySlug` (из frontmatter.description)
    * `aliasToSlugs` (для поиска конфликтов/тултипов)
* Экспортирует виртуальные модули:

  * `virtual:notes-manifest`
  * `virtual:notes-graph`
  * `virtual:notes-check` (отчёт для CI)
* Следит за изменениями `.md` в dev (HMR), инвалидация кэша.

## Рендер Markdown

* **markdown-it** + наш плагин **wikilinks**:

  * распознаёт `[[...]]`/`[[...|...]]`,
  * резолвит через `aliasMap` → slug,
  * добавляет классы `.is-missing` / `.is-ambiguous` и `data-amb-list` (для CSS-тултипа),
  * собирает **исходящие** ссылки (для бэклинков и проверки).

## Навигация и состояние

* **Pinia** хранит список открытых колонок (slug-и) и активный индекс.
* В URL — стэк колонок (history mode).
* При загрузке/перезагрузке:

  * восстановление стэка из URL (или `index.md`),
  * восстановление **активной** колонки и горизонтального скролла,
  * восстановление **вертикального** скролла каждой заметки (по slug).
* Горизонтальная прокрутка автоматически «доводит» вьюпорт до новой/активной колонки.
* Клик по колонке делает её активной.

---

# Как именовать, чтобы всё хорошо резолвилось

* Пиши **человеческие** заголовки (кириллица — приветствуется).
* Добавляй **aliases** для распространённых формулировок/переводов.
* При необходимости зафиксируй **slug** в фронтматтере (например, латиницей).
* Если видишь подсветку **двусмысленности**:

  * уточни алиас (сделай уникальным),
  * или задай явный `slug` и ссылаться начни конкретнее.

---

# Настройки и переменные окружения

`.env` (пример):

```
VITE_SITE_NAME="Заметки о ножах"
VITE_ANIM_LOADER_DELAY=200
VITE_ANIM_LOADER_MIN=500
VITE_ANIM_STAGGER=80
# для локальной «строгой» проверки:
# VITE_NOTES_FAIL_ON_BROKEN=true
```

---

# Деплой на GitHub Pages (важные моменты)

* В `vite.config.ts` выставляем `base` (Actions пробрасывает `VITE_BASE="/<repo>/"`).
* В CI копируем `index.html` → `404.html` (SPA fallback).
* PWA манифест и иконки лежат в `public/`.

---

# Быстрый старт для разработчика

```bash
npm i
npm run dev     # локальная разработка
npm run build   # сборка (+ отчёт ссылок)
npm run preview # PWA работает, можно тестить офлайн
```

Папки/файлы:

* `plugins/notesPlugin.ts` — предсборка заметок/графа
* `src/lib/` — `md.ts`, `seo.ts`, `anim.ts`, `slug.ts`, пр.
* `src/composables/useProgressiveReveal.ts` — умное появление/лоадер
* `src/components/` — `Shell.vue`, `Column.vue`, `TopBar.vue`, `SearchOverlay.vue`, `ShortcutsOverlay.vue`
* `src/store/` — Pinia stores (`columns`, `ui`)
* `src/types/virtual-modules.d.ts` — типы виртуальных модулей
* `public/` — фавиконки, PWA иконки

---
 
С пожеланиями и предложениями [пишите в телегу](https://t.me/isayev_ivan)


